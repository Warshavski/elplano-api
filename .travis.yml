branches:
  only:
    - master
    - develop
    - test
services:
  - redis-server
  - docker

jobs:
  include:
#    - stage: heroku
#      addons:
#        postgresql: 9.6
#      after_success:
#        - bundle exec codeclimate-test-reporter
#      cache:
#        - bundler
#      before_script:
#        - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
#          > ./cc-test-reporter
#        - chmod +x ./cc-test-reporter
#        - "./cc-test-reporter before-build"
#        - cp config/database.yml.travis config/database.yml
#        - psql -c 'create database travis_ci_test;' -U postgres
#      dist: trusty
#      language: ruby
#      rvm:
#        - 2.5.3
#      script:
#        - bundle exec rails db:migrate RAILS_ENV=test
#        - bundle exec rspec
#      after_script:
#        - "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
#      deploy:
#        provider: heroku
#        api_key:
#          secure: FxtsCynVCUO3drhU9Dy7BzFz3XM4wDQqAX0cUu0w83IIZ64ptIN01aCfNTMwnIr16q4jyBgPXBqY4DwI+zrXVhWQwMIBkIJcfNoR1LHFLX+nlrv0mO3OFJOujlHDPU/xEPRMIKnRtgXjpjdhCgXt70qiatPbo5q33Le1IazxjO+BAaTjJzyW6WBdYI9yfKZ2F9KtpPoCZC+jgOVpTyWYF/oHy0GqrBMvTJFGr405e1RVD3D/13WcZnm7hdbkWnWkBAMFpT4ZK5vPA5QU3KKmm7Lkw6v3o49umpvXst/wgjqXZdMZj3zIVhAqlOCo+9PfACJQMyXKVwcgn1RBRu4q3WemT0WMz55q7QKl3/rVYzYRXwPyD7FBDbKAOdMPo7b1VnZCAUiXz3SGnCPBY3QnpedkyerIuZZJp/fD70MOpnTaFFkys/b0t9OpYWmFJeG300ahOqcN5bxgkBBxpKPIoZtes3jjVnbxHiXdD4h0TweoQ5SkgChJg0zg96Bv4f3TD309/b7RRQVLTlRFH0KTIbwccP+68l3Ihf9rKgtCCOkhRwQl2u1XmitcYF9/HQN6vRPDPZ47v+xetSR4oegXuZUTNrFEAb2rR2xEAqMkw6G+kY202Y9pdDmvIMxIITySJ3Kk1RMB1SJe0Cs5oIb7r9nrKVF+jzKHgRcV/ucDsro=
#        app:
#          develop: elplano-api
#        on:
#          branches:
#            - develop
#        run:
#          - "rake db:migrate"
    - stage: docker
      install: skip
      before_script:
        - docker --version
        - docker-compose --version
      script:
        - sh scripts/test-image.sh
      deploy:
        - provider: script
          script: scripts/build-image.sh
          on:
            branches:
              - develop
